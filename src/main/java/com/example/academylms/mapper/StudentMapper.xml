<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.academylms.mapper.StudentMapper">
	
	<select id="selectStudentsByLecture" parameterType="map" resultType="com.example.academylms.dto.Student">
	    SELECT s.student_id AS studentId,
	           s.name,
	           s.email,
	           s.phone,
	           s.create_date AS createDate
	    FROM student s
	    JOIN lecture_enrollment le ON s.student_id = le.student_id
	    WHERE le.lecture_id = #{lectureId}
	      AND le.status = 1
	      <if test="searchWord != null and searchWord != ''">
	          AND s.name LIKE CONCAT('%', #{searchWord}, '%')
	      </if>
	    ORDER BY s.create_date DESC
	    LIMIT #{beginRow}, #{rowPerPage}
	</select>

	<select id="selectStudentsCountByLecture" parameterType="map" resultType="int">
	    SELECT COUNT(*)
	    FROM student s
	    JOIN lecture_enrollment le ON s.student_id = le.student_id
	    WHERE le.lecture_id = #{lectureId}
	      AND le.status = 1
	      <if test="searchWord != null and searchWord != ''">
	          AND s.name LIKE CONCAT('%', #{searchWord}, '%')
	      </if>
	</select>
	
	<!-- 강사 수강생 조회 -->
	<select id="selectStudentList" resultType="com.example.academylms.dto.Student">
		SELECT student_id AS studentId,
		       name,
		       email,
		       phone,
		       create_date AS createDate
		FROM student
		<where>
			<if test="searchWord != null and searchWord != ''">
				name LIKE CONCAT('%', #{searchWord}, '%')
			</if>
		</where>
		ORDER BY create_date DESC
		LIMIT #{beginRow}, #{rowPerPage}
	</select>
	
	<!-- 전체 수강생 인원 -->
	<select id="selectStudentCount" resultType="int">
		SELECT COUNT(*) 
		FROM student
		<where>
			<if test="searchWord != null and searchWord != ''">
				name LIKE CONCAT('%', #{searchWord}, '%')
			</if>
		</where>
	</select>
	
	<!-- 새로운 수강생 등록 -->
	<insert id="addStudent" parameterType="com.example.academylms.dto.Student">
		INSERT INTO student (
	        name,
	        email,
	        phone,
	        create_date
	    ) VALUES (
	        #{name},
	        #{email},
	        #{phone},
	        NOW()
	    )
	</insert>
	
	<!-- 수강생 정보 수정 -->
	<update id="updateStudent" parameterType="com.example.academylms.dto.Student">
		UPDATE student
	    SET
	        name = #{name},
	        email = #{email},
	        phone = #{phone}
	    WHERE student_id = #{studentId}
	</update>
	
	<!-- 수강생 정보 삭제 -->
	<delete id="deleteStudent" parameterType="int">
		DELETE FROM student
    	WHERE student_id = #{studentId}
	</delete>

</mapper>